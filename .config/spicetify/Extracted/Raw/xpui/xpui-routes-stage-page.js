"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[5523],{94089:(e,t,r)=>{r.r(t),r.d(t,{default:()=>ie});var n=r(44286),a=r(40904),i=r(93493),o=r(92107),u=r(54769),c=r(44206),s=(r(42486),r(79024),r(68216),r(43379),r(78397),r(97460),r(93577),r(5728),r(24136),r(54520),r(91531),r(93678),r(34145),r(33177),r(39324)),l=r(62822),d=r(12341),f=r(93091),p=r.n(f),h=r(30758),g=r(88677),v=r(31828),I=r(45117),b=(0,r(59724).h)(),y="sp://auth/v1/token_web_auth";function N(e){return E.apply(this,arguments)}function E(){return(E=(0,l.A)(p().mark((function e(t){var r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",void 0);case 2:return(r=new URL(y)).searchParams.append("audience",t),e.next=6,b.get(r.toString());case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}const k="NWSmcn03uY8Fosh_mYCi",O="N9ngMcd9oSDEd8zK5jBj",T="kYOJhuJ996EIMXFJD3By";var w=r(86070),S=function(e){var t=e.url,r=function(e){var t=(0,g.wA)(),r=(0,h.useState)(""),n=(0,d.A)(r,2),a=n[0],i=n[1],o=(0,h.useCallback)((0,l.A)(p().mark((function r(){var n;return p().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!e){r.next=6;break}return t((0,v.w9)()),r.next=4,N(e).catch((function(e){throw(0,I.t)().error("error: could not fetch IDT token!"),t((0,v.wm)(e)),e}));case 4:(n=r.sent)&&(t((0,v.sB)(n.accessToken)),i(n.accessToken));case 6:case"end":return r.stop()}}),r)}))),[e,t]);return(0,h.useEffect)((function(){e&&o()}),[e,o]),a}(e.clientId),n=function(){var e=(0,s.k)();if(e){var t=e.containerVersion;return t.substring(0,t.lastIndexOf("."))}}(),a="";return t&&n&&(a=function(e,t,r){var n=new URL(e);n.searchParams.append("utm_app_version",t),r&&(n.hash="#id_token=".concat(r));return n.toString()}(t,n,r)),(0,w.jsx)("div",{className:k,children:(0,w.jsx)("iframe",{title:o.Ru.get("web-player.the-stage.title"),name:"stage-view-frame",id:O,src:a,sandbox:"allow-scripts allow-same-origin"})})};r(77905);var C=r(97500),D=r.n(C),A=r(496),L=function(){var e=(0,h.useContext)(A.bi).scrollNodeChildRef;(0,h.useEffect)((function(){var t,r=null==e?void 0:e.current,n=null==e||null===(t=e.current)||void 0===t?void 0:t.className;return r&&(r.className=D()(n,T)),function(){r&&(r.className=D()(n))}}),[e])},m=r(21167),R=r(47281),P=r(72637),B=R.$S.PANEL_CLOSE_CLICK,j=(r(78551),r(26851),r(9750),r(5672),r(82467),r(20031),r(80366)),x=r(62774);var G=r(1217);function V(e,t){var r,a,i,u,c=(0,h.useRef)(),s=(0,h.useMemo)((function(){return new AbortController}),[]),l=s.signal,d=(r=(0,n.Zp)(),a=(0,g.d4)((function(e){return e.ui.history.canGoBack})),(0,h.useCallback)((function(){r(a?-1:"/")}),[r,a])),f=(i=(0,g.wA)(),u=(0,x.d)().enqueueSnackbar,{onSuccess:function(){u(o.Ru.get("feedback.link-copied")),i((0,v.ue)())},onError:function(e){u(o.Ru.get("error.generic")),i((0,v.sb)(e))}}),p=(0,h.useCallback)((function(r){if(e&&e.includes(r.origin)){var n=JSON.parse(r.data);"didRequestInitialize"===n.type?(c.current={source:r.source,options:{targetOrigin:r.origin}},function(e){var t=e.source,r=e.options,n=JSON.stringify({type:"ready",capabilities:{}});t.postMessage(n,r)}(c.current)):"didRequestIDToken"===n.type?(c.current={source:r.source,options:{targetOrigin:r.origin}},function(e,t){M.apply(this,arguments)}(c.current,t)):"didRequestClose"===n.type?d():"didRequestShare"===n.type&&function(e,t,r){U.apply(this,arguments)}(c.current,n,f)}}),[e,t,f,d]);(0,h.useEffect)((function(){return e&&window.addEventListener("message",(function(e){return p(e)}),{signal:l}),function(){s.abort()}}),[e,s,p,l])}function M(){return(M=(0,l.A)(p().mark((function e(t,r){var n,a,i,o;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.source,a=t.options,e.next=3,N(r);case 3:if(i=e.sent){e.next=6;break}return e.abrupt("return");case 6:if(i.accessToken){e.next=9;break}return e.abrupt("return");case 9:o=JSON.stringify({type:"didReceiveIDToken",token:i.accessToken}),n.postMessage(o,a);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(){return(U=(0,l.A)(p().mark((function e(t,r,n){var a,i,o,u,c;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.source,i=t.options,"didRequestShare"===r.type){e.next=3;break}return e.abrupt("return");case 3:return(u=(0,j.o_)(r.url))&&(o=u.toURL()),e.next=7,(0,G.l)(o).catch((function(e){throw n.onError(e),e}));case 7:n.onSuccess(),c={type:"didDismissShare",requestId:r.requestId},a.postMessage(JSON.stringify(c),i);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var K=r(64869);var _=r(28925),Z=(r(7651),r(30456),r(26701),r(37417),r(11737),r(51691),r(702),r(34192),r(88856),r(51565),r(18316),r(52542)),J=(r(25550),r(28169),r(15342),function(e){return e[e.NONE=0]="NONE",e[e.STT=1]="STT",e[e.IDT=2]="IDT",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e}({}));function q(e){switch(e){case 0:case"NONE":return J.NONE;case 1:case"STT":return J.STT;case 2:case"IDT":return J.IDT;default:return J.UNRECOGNIZED}}var Y=function(e){return e[e.INVALID=0]="INVALID",e[e.VALID=1]="VALID",e[e.ACTIVE=2]="ACTIVE",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e}({});function H(e){switch(e){case 0:case"INVALID":return Y.INVALID;case 1:case"VALID":return Y.VALID;case 2:case"ACTIVE":return Y.ACTIVE;default:return Y.UNRECOGNIZED}}var z=function(e){return e[e.ALCOHOL=0]="ALCOHOL",e[e.ENERGY_DRINKS=1]="ENERGY_DRINKS",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e}({});var F={fromJSON:function(e){return{id:X(e.id)?globalThis.String(e.id):"0",campaignId:X(e.campaignId)?globalThis.String(e.campaignId):"0",lookupToken:X(e.lookupToken)?globalThis.String(e.lookupToken):"",url:X(e.url)?globalThis.String(e.url):"",authType:X(e.authType)?q(e.authType):0,clientId:X(e.clientId)?globalThis.String(e.clientId):void 0,hasAudio:!!X(e.hasAudio)&&globalThis.Boolean(e.hasAudio),status:X(e.status)?H(e.status):0,restricted:!!X(e.restricted)&&globalThis.Boolean(e.restricted),gcpProjectId:X(e.gcpProjectId)?globalThis.String(e.gcpProjectId):"",defaultLocale:X(e.defaultLocale)?globalThis.String(e.defaultLocale):"",restrictions:globalThis.Array.isArray(null==e?void 0:e.restrictions)?e.restrictions.map((function(e){return function(e){switch(e){case 0:case"ALCOHOL":return z.ALCOHOL;case 1:case"ENERGY_DRINKS":return z.ENERGY_DRINKS;default:return z.UNRECOGNIZED}}(e)})):[],enableLegacySharing:!!X(e.enableLegacySharing)&&globalThis.Boolean(e.enableLegacySharing),hidePlayer:!!X(e.hidePlayer)&&globalThis.Boolean(e.hidePlayer),legacyBackBehavior:!!X(e.legacyBackBehavior)&&globalThis.Boolean(e.legacyBackBehavior),enableCheckout:!!X(e.enableCheckout)&&globalThis.Boolean(e.enableCheckout),allowedCountries:globalThis.Array.isArray(null==e?void 0:e.allowedCountries)?e.allowedCountries.map((function(e){return globalThis.String(e)})):[],restoreOnKilled:!!X(e.restoreOnKilled)&&globalThis.Boolean(e.restoreOnKilled),enableMediaDevices:!!X(e.enableMediaDevices)&&globalThis.Boolean(e.enableMediaDevices)}},toJSON:function(e){var t,r,n={};return"0"!==e.id&&(n.id=e.id),"0"!==e.campaignId&&(n.campaignId=e.campaignId),""!==e.lookupToken&&(n.lookupToken=e.lookupToken),""!==e.url&&(n.url=e.url),0!==e.authType&&(n.authType=function(e){switch(e){case J.NONE:return"NONE";case J.STT:return"STT";case J.IDT:return"IDT";case J.UNRECOGNIZED:default:return"UNRECOGNIZED"}}(e.authType)),void 0!==e.clientId&&(n.clientId=e.clientId),!1!==e.hasAudio&&(n.hasAudio=e.hasAudio),0!==e.status&&(n.status=function(e){switch(e){case Y.INVALID:return"INVALID";case Y.VALID:return"VALID";case Y.ACTIVE:return"ACTIVE";case Y.UNRECOGNIZED:default:return"UNRECOGNIZED"}}(e.status)),!1!==e.restricted&&(n.restricted=e.restricted),""!==e.gcpProjectId&&(n.gcpProjectId=e.gcpProjectId),""!==e.defaultLocale&&(n.defaultLocale=e.defaultLocale),null!==(t=e.restrictions)&&void 0!==t&&t.length&&(n.restrictions=e.restrictions.map((function(e){return function(e){switch(e){case z.ALCOHOL:return"ALCOHOL";case z.ENERGY_DRINKS:return"ENERGY_DRINKS";case z.UNRECOGNIZED:default:return"UNRECOGNIZED"}}(e)}))),!1!==e.enableLegacySharing&&(n.enableLegacySharing=e.enableLegacySharing),!1!==e.hidePlayer&&(n.hidePlayer=e.hidePlayer),!1!==e.legacyBackBehavior&&(n.legacyBackBehavior=e.legacyBackBehavior),!1!==e.enableCheckout&&(n.enableCheckout=e.enableCheckout),null!==(r=e.allowedCountries)&&void 0!==r&&r.length&&(n.allowedCountries=e.allowedCountries),!1!==e.restoreOnKilled&&(n.restoreOnKilled=e.restoreOnKilled),!1!==e.enableMediaDevices&&(n.enableMediaDevices=e.enableMediaDevices),n},create:function(e){return F.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,r,n,a,i,o,u,c,s,l,d,f,p,h,g,v,I,b,y,N={id:"0",campaignId:"0",lookupToken:"",url:"",authType:0,clientId:void 0,hasAudio:!1,status:0,restricted:!1,gcpProjectId:"",defaultLocale:"",restrictions:[],enableLegacySharing:!1,hidePlayer:!1,legacyBackBehavior:!1,enableCheckout:!1,allowedCountries:[],restoreOnKilled:!1,enableMediaDevices:!1};return N.id=null!==(t=e.id)&&void 0!==t?t:"0",N.campaignId=null!==(r=e.campaignId)&&void 0!==r?r:"0",N.lookupToken=null!==(n=e.lookupToken)&&void 0!==n?n:"",N.url=null!==(a=e.url)&&void 0!==a?a:"",N.authType=null!==(i=e.authType)&&void 0!==i?i:0,N.clientId=null!==(o=e.clientId)&&void 0!==o?o:void 0,N.hasAudio=null!==(u=e.hasAudio)&&void 0!==u&&u,N.status=null!==(c=e.status)&&void 0!==c?c:0,N.restricted=null!==(s=e.restricted)&&void 0!==s&&s,N.gcpProjectId=null!==(l=e.gcpProjectId)&&void 0!==l?l:"",N.defaultLocale=null!==(d=e.defaultLocale)&&void 0!==d?d:"",N.restrictions=(null===(f=e.restrictions)||void 0===f?void 0:f.map((function(e){return e})))||[],N.enableLegacySharing=null!==(p=e.enableLegacySharing)&&void 0!==p&&p,N.hidePlayer=null!==(h=e.hidePlayer)&&void 0!==h&&h,N.legacyBackBehavior=null!==(g=e.legacyBackBehavior)&&void 0!==g&&g,N.enableCheckout=null!==(v=e.enableCheckout)&&void 0!==v&&v,N.allowedCountries=(null===(I=e.allowedCountries)||void 0===I?void 0:I.map((function(e){return e})))||[],N.restoreOnKilled=null!==(b=e.restoreOnKilled)&&void 0!==b&&b,N.enableMediaDevices=null!==(y=e.enableMediaDevices)&&void 0!==y&&y,N}};var W={fromJSON:function(e){return{site:X(e.site)?F.fromJSON(e.site):void 0}},toJSON:function(e){var t={};return void 0!==e.site&&(t.site=F.toJSON(e.site)),t},create:function(e){return W.fromPartial(null!=e?e:{})},fromPartial:function(e){var t={site:void 0};return t.site=void 0!==e.site&&null!==e.site?F.fromPartial(e.site):void 0,t}};function X(e){return null!=e}var $=r(82316);function Q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ee(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(r),!0).forEach((function(t){(0,Z.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var te=function(){var e=(0,l.A)(p().mark((function e(t,r){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.build().withHost("".concat($.sp)).withMethod("GET").withoutMarket().withPath("/site/".concat(r)).withEndpointIdentifier("/site/{lookupId}").withJsonContentType().send().then((function(e){return ee(ee({},e),{},{body:W.fromJSON(e.body)})}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),re=r(75844),ne=function(e){var t,r,n=[e],a=(t=(0,g.wA)(),{onStart:function(){return t((0,v.p)())},onSuccess:function(){return t((0,v.n7)())},onError:function(e){return t((0,v.LR)(e))}}),i=a.onStart,o=a.onSuccess,u=a.onError,c=(0,_.I)({queryKey:n,queryFn:(r=(0,l.A)(p().mark((function t(){return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,te(re.n.getInstance(),e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)}))),function(){return r.apply(this,arguments)}),staleTime:6e5,gcTime:18e5}),s=c.data,d=c.error,f=c.isLoading,h=c.isError;return f?i():h?u(d):o(),{data:null==s?void 0:s.body.site,loading:f,isError:h}},ae=r(58114);const ie=function(e){var t,r,s,l,d,f;L(),t=(0,m.AI)(P.Z.NowPlayingView),r=t.isActive,s=t.panelSend,r&&s(B),f=(0,K.z)(),null===(l=f.getState())||void 0===l||!l.hasContext||null!==(d=f.getState())&&void 0!==d&&d.isPaused||f.pause();var p,I,b,y=(0,n.g)().lookupToken,N=void 0===y?"":y,E=ne(N),k=E.loading,O=E.data,T=E.isError;return p=N,I=(0,a.A)(),b=(0,g.wA)(),(0,h.useEffect)((function(){return b((0,v.Jo)({siteId:p,sessionId:I,startTime:Date.now()})),function(){b((0,v.et)())}}),[b,p,I]),V(null==O?void 0:O.url,null==O?void 0:O.clientId),(0,i.NC)(ae.n2U)?(0,w.jsx)(u.s,{children:k?(0,w.jsx)(c.LoadingPage,{hasError:T,errorMessage:o.Ru.get("error.generic")}):(0,w.jsx)(S,{url:null==O?void 0:O.url,clientId:null==O?void 0:O.clientId})}):(0,w.jsx)(c.LoadingPage,{hasError:T,errorMessage:o.Ru.get("error.not_found.title.page")})}},39324:(e,t,r)=>{r.d(t,{k:()=>o});var n=r(12341),a=r(30758),i=r(82583);function o(){var e=(0,i.t)(),t=(0,a.useState)(null),r=(0,n.A)(t,2),o=r[0],u=r[1];return(0,a.useEffect)((function(){var t=!0;return e.getVersionInfo().then((function(e){t&&u(e)})),function(){t=!1}}),[e,u]),o}}}]);
//# sourceMappingURL=xpui-routes-stage-page.js.map